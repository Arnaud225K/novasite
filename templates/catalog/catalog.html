{% extends 'base.html' %}
{% load static %}
{% load catalog_tags %}

{% block title_page %}
    {% if current_menu.title_main %}
	    {{ current_menu.title_main|my_safe:current_filial }}
    {% else %}
        {{ h1_title }}
    {% endif %}
{% endblock %}

{% block meta_keywords %}
    {% if current_menu.keywords %}
	    {{ current_menu.keywords|my_safe:current_filial }}
    {% else %}
        {{ h1_title }}
    {% endif %}
{% endblock %}

{% block meta_description %}
    {% if current_menu.keywords_description %}
	    {{ current_menu.keywords_description|my_safe:current_filial }}
    {% else %}
        {{ h1_title }}  В {{ current_filial.name_info }}
    {% endif %}
{% endblock %}

{% block title_page_og %}
    {% if current_menu.title_main %}
	    {{ current_menu.title_main|my_safe:current_filial }}
    {% else %}
        {{ h1_title }}
    {% endif %}
{% endblock %}

{% block meta_description_og %}
    {% if current_menu.keywords_description %}
	    {{ current_menu.keywords_description|my_safe:current_filial }}
    {% else %}
        {{ h1_title }}  В {{ current_filial.name_info }}
    {% endif %}
{% endblock %}



{% block page_styles %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/catalog.css'%}">
{% endblock %}

{% block content %}
    {% include "pages/catalog/p-catalog-list.html" %}
    {% include "includes/s-all/s-all-form/s-all-form.html" %}
{% endblock %}

{% comment %} {% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            document.querySelectorAll('.js-show-more').forEach(link => {
                link.addEventListener('click', async function(event) {
                    event.preventDefault();

                    const button = this;
                    const categoryId = button.dataset.categoryId;
                    let nextPage = button.dataset.nextPage;

                    if (!nextPage) return;

                    const url = `/api/get-more-children/${categoryId}/?page=${nextPage}`;
                    
                    const listContainer = button.previousElementSibling;

                    try {
                        button.textContent = 'Загрузка...';

                        const response = await fetch(url);
                        if (!response.ok) throw new Error('Network response was not ok');
                        const data = await response.json();

                        data.children.forEach(child => {
                            const li = document.createElement('li');
                            li.innerHTML = `<a href="${child.url}">${child.name}</a>`;
                            listContainer.appendChild(li);
                        });

                        if (data.has_next_page) {
                            button.dataset.nextPage = parseInt(nextPage) + 1;
                            button.textContent = 'Смотреть еще';
                        } else {
                            button.style.display = 'none';
                        }

                    } catch (error) {
                        console.error('Error fetching more categories:', error);
                        button.textContent = 'Ошибка. Попробовать еще?';
                    }
                });
            });
        });
    </script>
{% endblock %} {% endcomment %}